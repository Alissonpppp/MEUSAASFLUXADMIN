<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluxBlue - Admin</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { brand: { 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' } }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 text-slate-100 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const Icons = {
            Shield: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            Copy: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            LogOut: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
        };

        const DB_KEY = 'fluxblue_license_db';
        
        const AdminSystem = {
            init: () => {
                if (!localStorage.getItem(DB_KEY)) localStorage.setItem(DB_KEY, JSON.stringify({ keys: [], clientData: [] }));
            },
            getAll: () => JSON.parse(localStorage.getItem(DB_KEY)),
            generateKey: (durationDays, label) => {
                const db = AdminSystem.getAll();
                const key = 'FLUX-' + Math.random().toString(36).substr(2, 4).toUpperCase() + '-' + Math.random().toString(36).substr(2, 4).toUpperCase() + '-' + Date.now().toString().substr(-4);
                const now = new Date();
                const expires = new Date();
                expires.setDate(now.getDate() + parseInt(durationDays));

                const newLicense = { key, label, duration: durationDays, created: now.toISOString(), expires: expires.toISOString(), assignedEmail: null, status: 'available' };
                db.keys.push(newLicense);
                localStorage.setItem(DB_KEY, JSON.stringify(db));
                return newLicense;
            }
        };

        const AdminLogin = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [pass, setPass] = useState('');
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                if(email === 'Salatielvitorino45@gmail.com' && pass === 'p1p2p3p4P@') onLogin();
                else setError('Credenciais inválidas.');
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <form onSubmit={handleLogin} className="bg-slate-800 p-8 rounded-xl border border-slate-700 w-full max-w-sm">
                        <h2 className="text-2xl font-bold mb-6 text-center text-white">Admin Access</h2>
                        <input type="email" placeholder="Email" className="w-full bg-slate-900 border border-slate-700 text-white rounded p-3 mb-3" value={email} onChange={e=>setEmail(e.target.value)} />
                        <input type="password" placeholder="Senha" className="w-full bg-slate-900 border border-slate-700 text-white rounded p-3 mb-4" value={pass} onChange={e=>setPass(e.target.value)} />
                        {error && <p className="text-red-400 text-sm mb-4">{error}</p>}
                        <button className="w-full bg-brand-600 text-white font-bold py-3 rounded hover:bg-brand-700">Entrar</button>
                    </form>
                </div>
            );
        };

        const Generator = ({ onLogout }) => {
            const [duration, setDuration] = useState('30');
            const [generatedKey, setGeneratedKey] = useState(null);
            const [history, setHistory] = useState([]);

            useEffect(() => { 
                const db = AdminSystem.getAll();
                setHistory(db.keys.reverse());
            }, [generatedKey]);

            const handleGenerate = () => {
                const label = duration === '365' ? 'Anual' : duration === '30' ? 'Mensal' : 'Trial 7 Dias';
                const key = AdminSystem.generateKey(duration, label);
                setGeneratedKey(key);
            };

            const copyToClipboard = (text) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-999999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try { document.execCommand('copy'); alert('Chave copiada!'); } catch (err) { prompt("Copie:", text); }
                document.body.removeChild(textArea);
            };

            return (
                <div className="min-h-screen p-6 md:p-12">
                    <div className="max-w-4xl mx-auto">
                        <header className="flex justify-between items-center mb-10 border-b border-slate-700 pb-6">
                            <h1 className="text-2xl font-bold flex items-center gap-2"><Icons.Shield /> Gerador de Licenças</h1>
                            <button onClick={onLogout} className="text-sm bg-slate-800 px-4 py-2 rounded text-slate-300 hover:text-white flex gap-2 items-center"><Icons.LogOut /> Sair</button>
                        </header>
                        <div className="grid md:grid-cols-2 gap-8">
                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 h-fit">
                                <h2 className="font-bold mb-4 text-brand-400">Nova Chave</h2>
                                <select value={duration} onChange={(e) => setDuration(e.target.value)} className="w-full bg-slate-900 border border-slate-700 rounded p-3 mb-4 outline-none">
                                    <option value="7">7 Dias (Trial)</option>
                                    <option value="30">30 Dias (Mensal)</option>
                                    <option value="365">1 Ano (Anual)</option>
                                    <option value="3650">10 Anos (Vitalício)</option>
                                </select>
                                <button onClick={handleGenerate} className="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-3 rounded transition">Gerar Licença</button>
                                {generatedKey && (
                                    <div className="mt-6 bg-brand-900/30 border border-brand-500/30 p-4 rounded-lg">
                                        <p className="text-xs text-brand-300 mb-1">Chave Gerada:</p>
                                        <div className="flex items-center gap-2">
                                            <code className="text-xl font-mono font-bold text-white tracking-widest flex-1">{generatedKey.key}</code>
                                            <button onClick={() => copyToClipboard(generatedKey.key)} className="text-brand-400 hover:text-white"><Icons.Copy /></button>
                                        </div>
                                    </div>
                                )}
                            </div>
                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700">
                                <h2 className="font-bold mb-4 text-slate-300">Histórico</h2>
                                <div className="overflow-y-auto max-h-[400px] space-y-3 pr-2">
                                    {history.map((lic, idx) => (
                                        <div key={idx} className="bg-slate-900/50 p-3 rounded border border-slate-700/50">
                                            <div className="flex justify-between font-mono text-sm text-slate-200"><span>{lic.key}</span> <span className={lic.assignedEmail ? 'text-green-400' : 'text-yellow-400'}>{lic.assignedEmail ? 'Ativa' : 'Livre'}</span></div>
                                            <div className="text-xs text-slate-500 mt-1">{lic.label} • {lic.assignedEmail || 'Sem dono'}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const AdminApp = () => {
            const [auth, setAuth] = useState(false);
            useEffect(() => AdminSystem.init(), []);
            return auth ? <Generator onLogout={() => setAuth(false)} /> : <AdminLogin onLogin={() => setAuth(true)} />;
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<AdminApp />);
    </script>
</body>
</html>